/*
 * angular-http-batcher - v1.12.0 - 2015-10-12
 * https://github.com/jonsamwell/angular-http-batcher
 * Copyright (c) 2015 Jon Samwell
 */
!function(a,b){"use strict";function c(){var a=[],c="httpBatchAdapter",d={maxBatchedRequestPerCall:10,minimumBatchSize:2,batchRequestCollectionDelay:100,ignoredVerbs:["head"],sendCookies:!1,enabled:!0,adapter:c,uniqueRequestName:null};this.setAllowedBatchEndpoint=function(e,f,g){var h=b.copy(d);void 0!==g&&(b.forEach(g,function(a,b){h[b]=a}),b.forEach(h.ignoredVerbs,function(a,b){h.ignoredVerbs[b]=a.toLowerCase()})),h.serviceUrl=e,h.batchEndpointUrl=f,h.adapter=h.adapter||c,a.push(h)},this.getBatchConfig=function(b){var c,d,e;for(d=0;d<a.length;d+=1){c=a[d];for(var f in c.excludes)b.indexOf(c.excludes[f])>-1&&(e=!0);if(b.indexOf(c.serviceUrl)>-1&&!e)break;c=void 0}return c},this.canBatchCall=function(a,b){var c=this.getBatchConfig(a),d=c?c.canBatchRequest:void 0,e=!1;return c&&c.enabled===!0&&(e=d?d(a,b):c.batchEndpointUrl!==a&&a.indexOf(c.batchEndpointUrl)===-1&&c.ignoredVerbs.indexOf(b.toLowerCase())===-1),e},this.calculateBoundary=function(){return(new Date).getTime().toString()},this.$get=[function(){return this}]}function d(a,b,c,d,e){this.request=a,this.statusCode=b,this.statusText=c,this.data=d,this.headers=e}function e(c,d,e){function h(a,b){var i,j,k,m,n,o,d=e.calculateBoundary(),f={method:"POST",url:b.batchEndpointUrl,cache:!1,headers:b.batchRequestHeaders||{}},h=[];for(f.headers[g.contentType]="multipart/mixed; boundary="+d,j=0;j<a.length;j+=1){if(k=a[j],i=l(k.url),h.push(g.doubleDash+d),b.batchPartRequestHeaders)for(m in b.batchPartRequestHeaders)if(b.batchPartRequestHeaders.hasOwnProperty(m)){var p=m+g.colon+g.singleSpace+b.batchPartRequestHeaders[m];"content-disposition"===m.toLowerCase()&&null!==b.uniqueRequestName&&void 0!==b.uniqueRequestName&&(p+=g.semiColon+g.singleSpace+g.requestName+b.uniqueRequestName+j),h.push(p)}h.push("Content-Type: application/http; msgtype=request",g.emptyString),n=i.relativeUrl.split("?"),o=encodeURI(n[0])+(n.length>1?"?"+n[1]:""),h.push(k.method+" "+o+" "+g.httpVersion),h.push("Host: "+i.host);for(m in k.headers)h.push(m+g.colon+g.singleSpace+k.headers[m]);b.sendCookies===!0&&c[0].cookie&&c[0].cookie.length>0&&h.push("Cookie: "+c[0].cookie),h.push(g.emptyString),k.data&&h.push(k.data),h.push(g.emptyString)}return h.push(g.doubleDash+d+g.doubleDash),f.data=h.join(g.newline),f}function i(a,b,c){var h,i,d=[],e=m(b.headers()["content-type"]),f=b.data.split(g.doubleDash+e+g.newline),j=0;for(h=0;h<f.length;h+=1)i=f[h],i!==g.emptyString&&(d.push(p(i,a[j],e)),j+=1);return d}function j(a,b){return!0}function k(a){return a=a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function l(a){var b,c,e,f,h;if(a.indexOf("./")>-1||a.indexOf("../")>-1){var i=document.createElement("a");i.href=a,a=i.href}return a.indexOf("://")>-1?(f=a.indexOf("://")+3,h=a.slice(f).split(g.forwardSlash),b=a.substring(0,f),c=h[0],e=function(){return delete h[0],h.join(g.forwardSlash)}()):(e=a,b=d.location.protocol,c=d.location.host),{protocol:b,host:c,relativeUrl:e}}function m(a){var b="boundary=",c=a.indexOf(b),d=a.indexOf(";",c),e=a.substring(c+b.length,d>0?d:a.length);return e=e.replace(/"/g,g.emptyString)}function n(a){return"string"==typeof a?a.replace(")]}',\n",""):a}function o(a,c){var d=c;return a=a.toLowerCase(),a.indexOf("json")>-1?(c=n(c),d=b.fromJson(c)):a.indexOf("png")>-1,d}function p(b,c,d){var h,i,j,l,m,n,e=b.split(g.newline),f={headers:{}},p=!1;for(i=0;i<e.length;i+=1)if(h=e[i],h!==g.emptyString){if(void 0===f.contentType&&h.indexOf("-Type")!==-1&&h.indexOf("; msgtype=response")===-1)f.contentType=h.split(g.forwardSlash)[1];else if(void 0!==f.contentType&&p===!1)n=h.split(g.colon),f.headers[n[0]]=k(n[1]);else if(void 0===f.statusCode&&h.indexOf(g.httpVersion)!==-1)m=h.split(g.singleSpace),f.statusCode=parseInt(m[1],10),f.statusText=m.slice(2).join(g.singleSpace);else if(void 0===f.data&&p){for(f.data="",j=1,l=new RegExp("--"+d+"--","i");l.test(h)===!1&&i+j<=e.length;)f.data+=h,h=e[i+j],j+=1;f.data=o(f.contentType,f.data);break}}else p=void 0!==f.contentType;return f.headers[g.contentType]=f.contentType,new a.ahb.HttpBatchResponseData(c,f.statusCode,f.statusText,f.data,f.headers)}var f=this,g={httpVersion:"HTTP/1.1",contentType:"Content-Type",newline:"\r\n",emptyString:"",singleSpace:" ",forwardSlash:"/",doubleDash:"--",colon:":",semiColon:";",requestName:"name="};f.key="httpBatchAdapter",f.buildRequest=h,f.parseResponse=i,f.canBatchRequest=j}function f(){function c(a,b){var d,e,f,g,c={method:"GET",url:b.batchEndpointUrl+"?",cache:!1,headers:b.batchRequestHeaders||{}};for(e=0;e<a.length;e+=1)f=a[e],g=f.url.split("?"),d=g[0].replace(b.serviceUrl,""),g.length>1&&(d+="?"+encodeURIComponent(g[1])),e>0&&(c.url+="&"),c.url+=e.toString()+"="+d;return c}function d(b,c){var e,f,h,d=[],g=c.data;for(e=0;e<b.length;e+=1)f=b[e],h=g[e.toString()],d.push(new a.ahb.HttpBatchResponseData(f,h.statusCode,"",h.body,h.headers));return d}function e(a){return"GET"===a.method}var b=this;b.key="nodeJsMultiFetchAdapter",b.buildRequest=c,b.parseResponse=d,b.canBatchRequest=e}function g(a){var b,c="";for(b in a)c+=b+": "+a[b]+"\n";return c}function h(){var a=this.config.adapter;if("object"==typeof a){if(void 0===a.buildRequest||void 0===a.parseResponse)throw new Error('A custom adapter must contain the methods "buildRequest" and "parseResponse" - please see the docs')}else if("string"==typeof a&&(a=this.adapters[a],void 0===a))throw new Error("Unknown type of http batch adapter: "+this.config.adapter);return a}function i(a){return this.requests.push(a),this.requests.length>=this.config.maxBatchedRequestPerCall&&this.flush(),!0}function j(){var a=this,c=a.getAdapter(),d=c.buildRequest(a.requests,a.config);a.sendCallback(),a.$injector.get("$http")(d).then(function(d){var e=c.parseResponse(a.requests,d,a.config);b.forEach(e,function(a){a.request.callback(a.statusCode,a.data,g(a.headers),a.statusText)})},function(c){b.forEach(a.requests,function(a){a.callback(c.statusCode,c.data,c.headers,c.statusText)})})}function k(){this.$timeout.cancel(this.currentTimeoutToken),this.currentTimeoutToken=void 0,this.send()}function l(a,c,d,e,f){var g=this;this.$injector=a,this.$timeout=c,this.adapters=d,this.config=e,this.sendCallback=f,this.requests=[],this.currentTimeoutToken=c(function(){g.currentTimeoutToken=void 0,g.requests.length<g.config.minimumBatchSize?(g.sendCallback(),b.forEach(g.requests,function(a){a.continueDownNormalPipeline()})):g.send(a)},e.batchRequestCollectionDelay,!1)}function m(a,c,d,e,f){function j(a,b){return d.canBatchCall(a,b)}function k(b){var e=d.getBatchConfig(b.url),f=h[e.batchEndpointUrl];void 0===f&&(f=new l(a,c,i,e,function(){delete h[e.batchEndpointUrl]}),h[e.batchEndpointUrl]=f),f.addRequest(b)}function m(a){b.forEach(h,function(b,c){var d=void 0===a||a&&c.toLocaleLowerCase()===a.toLocaleLowerCase();d&&b.flush()})}var g=this,h={},i={httpBatchAdapter:e,nodeJsMultiFetchAdapter:f};g.canBatchRequest=j,g.batchRequest=k,g.flush=m}function n(a,c){var d=function(b,d,e,f,g,h,i,j){var k=this,l=arguments;return c.canBatchRequest(d,b)?void c.batchRequest({method:b,url:d,data:e,callback:f,headers:g,timeout:h,withCredentials:i,responseType:j,continueDownNormalPipeline:function(){a.apply(k,l)}}):a.apply(this,arguments)};return b.mock&&b.forEach(a,function(a,b){d[b]=a}),d}function o(a){a.decorator("$httpBackend",n)}a.ahb={name:"jcs.angular-http-batch"},b.module(a.ahb.name,[]),b.module(a.ahb.name).provider("httpBatchConfig",c),a.ahb.HttpBatchResponseData=d,e.$inject=["$document","$window","httpBatchConfig"],b.module(a.ahb.name).service("httpBatchAdapter",e),b.module(a.ahb.name).service("nodeJsMultiFetchAdapter",f),l.prototype.getAdapter=h,l.prototype.send=j,l.prototype.addRequest=i,l.prototype.flush=k,m.$inject=["$injector","$timeout","httpBatchConfig","httpBatchAdapter","nodeJsMultiFetchAdapter"],b.module(a.ahb.name).service("httpBatcher",m),n.$inject=["$delegate","httpBatcher"],o.$inject=["$provide"],b.module(a.ahb.name).config(o)}(window,angular);