(function () {
    "use strict";
    angular.module('globalApp').directive("ocsRichtexteditor", ['$rootScope', 'templateUrlService', directiveFunction]);

    function directiveFunction($rootScope, templateUrlService) {
        return {
            restrict: "E",
            scope: {
                meta: "=",
                model: "="
            },
            templateUrl: function (element, attrs) { return attrs.templateUrl || templateUrlService.get('ocs-RichTextEditor.html'); },
            controller: ['$scope', function ($scope) {
                $scope.defaultOptions = {
                    statusbar: false,
                    menubar: false,
                    selector: 'textarea',
                    height: 300,
                    skin_url: $rootScope.registry.localStore.global.context.cdnUrl + '/styles/tinymce/skins/lightgray',
                    theme: 'modern',
                    forced_root_block: '',
                    plugins: [
                      'advlist autolink lists link charmap print preview hr anchor pagebreak',
                      'searchreplace visualblocks visualchars code contextmenu',
                      'paste textcolor colorpicker textpattern'
                    ],
                    toolbar1: 'insertfile undo redo | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link',
                    toolbar2: 'print preview | forecolor backcolor'
                };

                $scope.getOptions = function () {
                    if ($scope.meta.options) {
                        return angular.extend($scope.defaultOptions, $scope.meta.options);
                    }
                    return $scope.meta.options;
                }
            }],
            link: function (scope, element, attrs) {
                //set the elementId generated by the underlying tinyMCE directive
                scope.elementId = element.find('textarea').attr('id');
            }
        };
    };
})();


